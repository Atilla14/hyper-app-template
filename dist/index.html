<html>
<head>
    <title>ICICI</title>
	<script type="text/javascript">
	console.log("did this load?")
    window.__host = window.location.host;

	window.__createSrc = function(id, host, fileName){
		var headID = document.getElementsByTagName("head")[0];
        var newScript = document.createElement('script');
        newScript.type = 'text/javascript';
        if(id)
            newScript.id = id;
        newScript.src = 'http://' + host + '/' + fileName;
        headID.appendChild(newScript);
	}
	__createSrc(null, window.__host, 'socket.js');

    </script>
    <script type="text/javascript">
    console.log('Begin');
	var reloadApp = function() {
        __createSrc('mystique', window.__host, 'bundle.js');
	}
	var currentHash = null
	var onSocketMsg = {
		hot: function() {
			console.log("hot");
		},
		invalid: function() {
			console.log("App updated. Recompiling...");
		},
		hash: function(hash) {
			currentHash = hash;
			console.log(hash);
		},
		"still-ok": function() {
			console.log("App ready.");
		},
		ok: function() {
			console.log("It is ok");
			reloadApp();
		},
		warnings: function(warnings) {
			console.log("Warnings while compiling.");
			reloadApp();
		},
		errors: function(errors) {
			console.log("App updated with errors. No reload!");

			if (Android)
			Android.throwError(errors[0]);
		},
		"proxy-error": function(errors) {
			console.log("Could not proxy to content base target!");

			if (Android)
			Android.throwError(errors[0]);
		},
		close: function() {
			//console.log("Disconnected.");
		},
		"log-level": function(){
		}
	}
	window.onload = function() {
	    console.log('onload');
		var sock = new SockJS('http://' + window.__host + '/sockjs-node');
		sock.onopen = function() {
		   console.log('open');
		};
		sock.onmessage = function(e) {
		  var msg = JSON.parse(e.data);
			onSocketMsg[msg.type](msg.data)
		};
		sock.onclose = function() {
		   console.log('close');
		};
	}

</script>
</head>
</html>
